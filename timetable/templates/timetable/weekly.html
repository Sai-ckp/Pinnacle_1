{% extends 'master/layout.html' %}
{% load utils %}

{% block content %}
<style>
    body {
        background-color: #f8f9fa;
        font-family: 'Segoe UI', sans-serif;
        font-size: 12px;
    }

    input,
    select,
    textarea,
    .form-select,
    .form-control {
        font-size: 12px !important;
        padding: 4px 8px;
        height: auto;
        border: 1px solid #ced4da;
        border-radius: 4px;
        box-shadow: none;
    }

    .content {
        padding: 42px 37px 3px;
        flex-grow: 1;
        margin-left: 75px;
    }

    .table th,
    .table td {
        vertical-align: middle;
        padding: 2px;
        font-size: 12px;
    }

    .badge {
        font-size: 12px;
    }

    .subject-box {
        padding: 2px 2px 2px 6px; /* top, right, bottom, left */
        margin-bottom: 8px;
        background-color: #ffffff;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        width: 96%;
        font-size: 12px;
        text-align: left; /* this aligns the text to the left */
    }



    .subject-name {
        font-weight: 600;
        color: #212529;
        font-size: 12px;
    }

    .faculty-name {
        font-size: 12px;
        color: #6c757d;
    }

    .room-badge {
        font-size: 12px;
        background-color: #d0ebff;
        color: #084298;
    }

    .table thead th {
        background-color: #800000;
        color: white;
        font-size: 12px;
        text-align: center;
        width: 55px;
    }

    .heading {
        color: #800000;
        font-size: 22px;
        text-align: center;
        margin-bottom: 15px;
        margin-top: 10px;
    }

    .sidebar {
        width: 200px;
        height: 100vh;
        background: linear-gradient(135deg, #8B0000, #800000); /* Maroon gradient */
        color: white;
        padding-top: 0px;
        position: fixed;
        top: 0;
        left: 0;
        display: flex;
        flex-direction: column;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.5) transparent;
    }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 4px;
        }

        .sidebar a {
            color: white;
            text-decoration: none;
            padding: 10px 8px;
            display: block;
            font-weight: 500;
            font-size: 19px;
        }

    .dropdown-btn {
        background: none;
        border: none;
        color: white;
        text-align: left;
        padding: 10px 8px;
        font-weight: 500;
        cursor: pointer;
        font-family: inherit;
        display: block;
        width: 100%;
        font-size: 17px;
    }
    .topbar {
        background: linear-gradient(135deg, #8B0000, #800000);
        padding: 12px 12px;
        color: white;
        width: calc(100% - 200px);
        position: fixed;
        top: 0;
        left: 200px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
        z-index: 1000;
    }

        .topbar a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            margin: 0 -24px;
            white-space: nowrap;
        }

            .topbar a:hover {
                text-decoration: underline;
            }

    .filter-form .form-select {
        display: inline-block;
        width: auto;
        min-width: 220px;
        margin-right: 15px;
        margin-top: 11px;
        margin-bottom: 13px;
        font-size: 12px;
    }
</style>


<div class="container mt-5" style=" margin-left: 119px;">
    <h2 class="heading">
        {% if semester %}{{ semester }} - Weekly Timetable{% else %}Weekly Timetable{% endif %}
    </h2>

    <!-- Filter Form -->
    <form method="get" class="mb-4 text-center filter-form">
            <label><strong>Course Type</strong></label>
            <select name="course_type" class="form-select d-inline" onchange="this.form.submit()">
                <option value="">Select Course Type</option>
                {% for ct in course_types %}
                <option value="{{ ct.id }}" {% if ct.id|stringformat:"s" == selected_course_type %}selected{% endif %}>{{ ct.name }}</option>
                {% endfor %}
            </select>
       

            <label><strong>Course</strong></label>
            <select name="course" class="form-select d-inline" onchange="this.form.submit()">
                <option value="">Select Course</option>
                {% for course in courses %}
                <option value="{{ course.id }}" {% if course.id|stringformat:"s" == selected_course %}selected{% endif %}>{{ course.name }}</option>
                {% endfor %}
            </select>

            <label><strong>Semester</strong></label>
            <select name="semester" class="form-select d-inline" onchange="this.form.submit()">
                <option value="">Select Semester</option>
                {% for sem in semesters %}
                <option value="{{ sem.number }}" {% if sem.number|stringformat:"s" == selected_semester %}selected{% endif %}>Semester {{ sem.number }}</option>
                {% endfor %}
            </select>
    </form>

    <!-- Timetable Table -->
    {% if semester and time_slots %}
    <div class="card shadow border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-bordered text-center align-middle mb-0">
                    <thead>
                        <tr>
                            <th style="width: 12%;">Time</th>
                            {% for day in week_days %}
                            <th>{{ day }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for time in time_slots %}
                        <tr class="table-light">
                            <td class="fw-semibold bg-white">{{ time }}</td>
                            {% for day in week_days %}
                            <td>
                                {% with entries=timetable|dict_get:day %}
                                {% for entry in entries %}
                                {% if entry.time_slot == time %}
                                <div class="subject-box">
                                    <div class="subject-name">{{ entry.subject.name }}</div>
                                    <div class="faculty-name">{{ entry.faculty.name }}</div>
                                    <div class="faculty-name">{{ entry.faculty.role }}</div>

                                    <div><span class="badge room-badge">{{ entry.room }}</span></div>
                                   
                                </div>
                                {% endif %}
                                {% endfor %}
                                {% endwith %}
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% elif selected_semester %}
    <div class="alert alert-warning mt-4 text-center">
        No timetable entries found for the selected semester.
    </div>
    {% endif %}
</div>
{% endblock %}
