{% extends 'layout.html' %}
{% load form_filters %}

{% block title %}
    {% if is_view %}View{% elif form.instance.pk %}Edit{% else %}Add{% endif %} Book
{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f4f6f9;
        color: #333;
    }

    .form-container {
        max-width: 900px;
        margin: 25px auto;
        background: #ffffff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 0 12px rgba(0, 0, 0, 0.05);
    }

    h3 {
        font-weight: 600;
        color: #8b0000;
        margin-bottom: 20px;
        font-size: 22px;
        text-align: center;
    }

    .form-label {
        font-weight: 500;
        font-size: 14px;
        margin-bottom: 6px;
        display: block;
    }

    .form-control, .form-select {
        font-size: 14px;
        padding: 6px;
        border-radius: 5px;
        border: 1px solid #ccc;
        margin-bottom: 12px;
        width: 100%;
    }

    .upload-area {
        border: 2px dashed #ccc;
        border-radius: 8px;
        text-align: center;
        padding: 2rem;
        cursor: pointer;
        margin-bottom: 16px;
    }

        .upload-area.dragover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }

    .btn-save {
        background-color: #800000;
        font-weight: 500;
        padding: 5px 16px;
        font-size: 14px;
        color: white;
        border: none;
        border-radius: 8px;
    }

        .btn-save:hover {
            background-color: #660000;
        }

    .btn-back {
        background-color: #800000;
        color: #fff;
        border: 2px solid #800000;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.2s ease;
    }

        .btn-back:hover {
            background-color: #660000;
        }

    .text-danger {
        font-size: 13px;
    }

    .content {
        margin-left: 200px;
        padding: 21px 26px 40px;
        min-height: 100vh;
    }
</style>

<div class="container form-container">
    <h3>{% if is_view %}View{% elif form.instance.pk %}Edit{% else %}Add{% endif %} Book</h3>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row">
            <!-- Left Column -->
            <div class="col-md-6">
                <label class="form-label">Title</label>
                {{ form.title }}
                <div class="text-danger">{{ form.title.errors }}</div>

                <label class="form-label">Authors</label>
                {{ form.authors }}
                <div class="text-danger">{{ form.authors.errors }}</div>

                <label class="form-label">Category</label>
                {{ form.category }}
                <div class="text-danger">{{ form.category.errors }}</div>

                <label class="form-label">Publication Date</label>
                {{ form.publication_date }}
                <div class="text-danger">{{ form.publication_date.errors }}</div>

                <label class="form-label">Edition</label>
                {{ form.edition }}
                <div class="text-danger">{{ form.edition.errors }}</div>

                <label class="form-label">Available Copies</label>
                {{ form.available_copies }}
                <div class="text-danger">{{ form.available_copies.errors }}</div>

                <label class="form-label">Summary</label>
                {{ form.summary }}
                <div class="text-danger">{{ form.summary.errors }}</div>
            </div>

            <!-- Right Column -->
            <div class="col-md-6">
                <!--<label class="form-label">Upload Cover Image</label>
                <div class="upload-area" id="upload-area">
                    <span>Drag and drop or click to upload</span>
                    {{ form.cover_image }}
                </div>
                <div class="text-danger">{{ form.cover_image.errors }}</div>-->

                <label class="form-label">Publisher</label>
                {{ form.publisher }}
                <div class="text-danger">{{ form.publisher.errors }}</div>

                <label class="form-label">ISBN (International Standard Book Number)</label>
                {{ form.isbn }}
                <div class="text-danger">{{ form.isbn.errors }}</div>

                <label class="form-label">Tags</label>
                {{ form.tags }}
                <div class="text-danger">{{ form.tags.errors }}</div>
            </div>

            <label class="form-label">Status</label>
            <div class="form-check mb-2">
                <input type="radio" name="status" value="active" class="form-check-input"
                       {% if form.data.status == 'active' or form.instance.status == 'active' %}checked{% endif %}
                       {% if is_view or form.instance.available_copies == 0 %}disabled{% endif %}>
                <label class="form-check-label">Available</label>
            </div>
            <div class="form-check">
                <input type="radio" name="status" value="inactive" class="form-check-input"
                       {% if form.data.status == 'inactive' or form.instance.status == 'inactive' %}checked{% endif %}
                       {% if is_view %}disabled{% endif %}>
                <label class="form-check-label">Unavailable</label>
            </div>
            <div class="text-danger">{{ form.status.errors }}</div>
        </div>

        <div class="d-flex justify-content-between mt-4">
            <a href="{% url 'book_list' %}" class="btn-back">Back</a>
            {% if not is_view %}
            <button type="submit" class="btn-save">
                {% if form.instance.pk %}Update{% else %}Save{% endif %}
            </button>
            {% endif %}
        </div>
    </form>
</div>

<script>
    const uploadArea = document.getElementById('upload-area');
    const fileInput = document.getElementById('id_cover_image');

    uploadArea?.addEventListener('click', () => {
        if (!{{ is_view|yesno:"false,true" }}) fileInput?.click();
    });

    uploadArea?.addEventListener('dragover', (e) => {
        e.preventDefault();
        if (!{{ is_view|yesno:"false,true" }}) uploadArea.classList.add('dragover');
    });

    uploadArea?.addEventListener('dragleave', () => {
        uploadArea?.classList.remove('dragover');
    });

    uploadArea?.addEventListener('drop', (e) => {
        e.preventDefault();
        if (!{{ is_view|yesno:"false,true" }}) {
            uploadArea?.classList.remove('dragover');
            if (fileInput) fileInput.files = e.dataTransfer.files;
        }
    });

    // ISBN input filter
    const isbnInput = document.getElementById('id_isbn');
    isbnInput?.addEventListener('input', function () {
        this.value = this.value.replace(/[^0-9\-\/,:]/g, '');
    });
</script>

{% endblock %}
