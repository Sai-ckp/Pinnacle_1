{% extends 'master/layout.html' %}
{% block title %}Student Attendance Form{% endblock %}
{% block content %}
<style>
    .form-section {
        background: #fff;
        padding: 31px;
        border-radius: 12px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        margin-top: 40px;
        margin-left: 101px;
        margin-right: 27px;
        width: 904px;
    }

    label {
        font-weight: 600;
        margin-right: -10px;
        font-size: 12px;
    }

    select, input[type="date"] {
        padding: 6px;
        margin: 5px 10px 10px 0;
        min-width: 180px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    input[readonly] {
        background-color: #e9ecef;
    }

    .table-section {
        margin-top: 20px;
        margin-left: 10px;
        margin-right: 10px;
        overflow-x: auto;
        width: 100%;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
        table-layout: fixed;
    }

    th {
        padding: 8px;
        border: 1px solid #dee2e6;
        text-align: center;
        vertical-align: middle;
        word-wrap: break-word;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 150px;
    }

    td {
        border: 1px solid #dee2e6;
        text-align: center;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .table-responsive {
        margin-top: 20px;
        overflow-x: hidden;
    }

    th {
        background-color: #800000;
        color: white;
        padding: 4px;
        font-size: 11px;
    }

    .btn-submit {
        background-color: #800000;
        color: white;
        padding: 8px 9px;
        border: none;
        border-radius: 6px;
        font-size: 12px;
        margin-top: 12px;
        margin-left: 847px;
    }

    .btn-submit:hover {
        background-color: #660000;
    }

    .btn-container {
        display: flex;
        justify-content: flex-end;
    }

    .firsts {
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        gap: 12px;
        margin: 20px;
        overflow-x: auto;
    }

    .firsts select,
    .firsts input[type="date"],
    .firsts input[type="text"] {
        min-width: 140px;
        max-width: 200px;
        font-size: 13px;
        padding: 6px 8px;
        flex-shrink: 0;
    }

    .content {
        padding: 10px 26px 18px;
        /* background-color: #EEE; */
        margin-left: 128px;
        flex-grow: 1;
    }

    td input[type="radio"] {
        margin-bottom: 2px;
    }

    td label {
        display: flex;
        flex-direction: row;
        align-items: center;
        font-size: 12px;
        gap: 4px;
    }

    .status-options {
        display: flex;
        /* justify-content: center; */
        gap: 13px;
    }
</style>

<div class="form-section">
    <h4 style="text-align: center; font-size: 22px; color: #800; margin-top: -17px;">Student Attendance Form</h4>
    <form method="POST">
        {% csrf_token %}
        <div class="firsts">
            <select name="course" id="course" onchange="document.getElementById('form_action').value='dropdown_change'; this.form.submit()">
                <option value="">-- Select Course --</option>
                {% for course in courses %}
                    <option value="{{ course.id }}" {% if course.id == selected_course_id %}selected{% endif %}>{{ course.name }}</option>
                {% endfor %}
            </select>

            <select name="subject" id="subject" onchange="document.getElementById('form_action').value='dropdown_change'; this.form.submit()" {% if not selected_course_id %}disabled{% endif %}>
                <option value="">-- Select Subject --</option>
                {% for subject in subjects %}
                    <option value="{{ subject.id }}" {% if subject.id == selected_subject_id %}selected{% endif %}>{{ subject.name }}</option>
                {% endfor %}
            </select>

            <input type="date" name="attendance_date" value="{{ today|date:'Y-m-d' }}" required>
            <input type="hidden" name="form_action" id="form_action" value="dropdown_change">

            <label>Faculty Name:</label>
            {% if selected_subject %}
                <input type="text" name="faculty_name" value="{{ selected_subject.faculty }}" readonly style="background-color: #fff; border: 1px solid #ccc; border-radius: 4px; ">
            {% else %}
                <input type="text" name="faculty_name" value="" readonly style="background-color: #fff; border: 1px solid #ccc; border-radius: 4px; ">
            {% endif %}
        </div>

        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
            <table class="table table-bordered table-striped table-hover mt-3">
                <thead>
                    <tr>
                        <th>Sl No</th>
                        <th>Student Name</th>
                        <th>Admission No</th>
                        <th>Student UserID</th>
                        <th>Subject</th>
                        <th>Status</th>
                        <th>Remarks</th>
                        <th>Overall Attendance (%)</th>
                    </tr>
                </thead>
                <tbody>
                    {% if student_subject_pairs %}
                        {% for entry in student_subject_pairs %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ entry.student.student_name }}</td>
                            <td>{{ entry.student.admission_no }}</td>
                            <td>{{ entry.student.student_userid }}</td>
                            <td>{{ entry.subject.name }}</td>
                            <td>
                                <div class="status-options">
                                    <label><input type="radio" name="status_{{ entry.student.admission_no }}" value="present" required>P</label>
                                    <label><input type="radio" name="status_{{ entry.student.admission_no }}" value="late">L</label>
                                    <label><input type="radio" name="status_{{ entry.student.admission_no }}" value="absent">A</label>
                                </div>
                            </td>
                            <td>
                                <input type="text" name="remarks_{{ entry.student.admission_no }}" placeholder="Optional" style="width: 100%; font-size: 12px; margin: 1px -82px 1px -74px; border: #fff; text-align: center;">
                            </td>
                            <td>{{ entry.attendance_percentage }}%</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="7">Please select a course and subject to view student attendance form.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <button type="submit" class="btn-submit"
                onclick="document.getElementById('form_action').value='submit_attendance'"
                {% if not student_subject_pairs %}disabled{% endif %}>
            Submit
        </button>
    </form>
</div>
{% endblock %}
