<!--{% extends 'master/layout.html' %}
{% load static %}
 
{% block content %}
 
 
<style>
    body {
        background-color: #f8f9fa;
        font-family: 'Segoe UI', sans-serif;
        font-size: 13px;
    }
 
    h2 {
        font-weight: 700;
        color: #800000;
        text-align: center;
        margin-bottom: 30px;
    }
 
    form#studentForm {
        background-color: #fff;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.08);
    }
 
    label {
        font-weight: 500;
        font-size: 13px;
        color: #333;
        margin-bottom: 5px;
    }
 
    input[type="text"],
    input[type="number"],
    input[type="date"],
    select {
        font-size: 13px;
        padding: 6px 10px;
        border-radius: 5px;
        border: 1px solid #ced4da;
        width: 100%;
    }
 
    input[readonly] {
        background-color: #f1f1f1;
        pointer-events: none;
        border-color: #ddd;
    }
 
    .section-heading {
        margin-top: 30px;
        margin-bottom: 20px;
        font-weight: 600;
        color: #800000;
        font-size: 15px;
        border-left: 4px solid #800000;
        padding-left: 10px;
    }
 
    .form-group {
        margin-bottom: 15px;
    }
 
    .input-group > input {
        flex: 1;
    }
 
    .input-group > button {
        margin-left: 5px;
        padding: 6px 14px;
        border-radius: 5px;
        background-color: #800000;
        color: white;
        border: none;
    }
 
    .input-group > button:hover {
        background-color: #a00000;
    }
 
    button.btn-success {
        font-size: 13px;
        padding: 8px 20px;
       background-color: #800000;
        color: #fff;
        border: none;
        border-radius: 5px;
        margin-top: 25px;
    }
 
    button.btn-success:hover {
        background-color: #800000;
    }
 
 
    #qr-code-section img {
        border: 1px solid #ddd;
        padding: 5px;
        margin-top: 10px;
        border-radius: 4px;
    }
</style>
 
<div class="container mt-4">
    <h2>Student Fee Entry</h2>
    <form method="POST" id="studentForm">
        {% csrf_token %}-->
 
        <!-- Admission No -->
        <!--<div class="mb-3">
            <label>Admission No</label>
            <div class="input-group d-flex">
                <input type="text" name="admission_no" id="admission_no" class="form-control" required value="{{ student.admission_no }}">
                <button type="button" id="fetchData">Fetch</button>
            </div>
        </div>-->
 
        <!-- Student Name and Course -->
        <!--<div class="row">
            <div class="col-md-6 form-group">
                <label>Student Name</label>
                <input type="text" name="name" id="name" class="form-control" readonly value="{{ student.name }}">
            </div>
            <div class="col-md-6 form-group">
                <label>Course</label>
                <input type="text" name="course" id="course" class="form-control" readonly value="{{ student.course }}">
            </div>
        </div>-->
 
        <!-- Tuition Fee Section -->
        <!--<div class="section-heading">Tuition Fee</div>
        <div class="row">
            <div class="col-md-4 form-group">
                <label>Tuition Fee</label>
                <input type="number" name="tuition_fee" class="form-control" readonly value="{{ student.tuition_fee }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Scholarship</label>
                <input type="number" name="scholarship" class="form-control" readonly value="{{ student.scholarship }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Advance Paid</label>
                <input type="number" name="tuition_advance_amount" class="form-control" readonly value="{{ student.tuition_advance_amount }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Final Fee After Advance</label>
                <input type="number" name="final_fee_after_advance" class="form-control" readonly value="{{ student.final_fee_after_advance }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Tuition Received</label>
                <input type="number" name="tuition_fee_paid" class="form-control" readonly value="{{ student.tuition_fee_paid }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Tuition Pending</label>
                <input type="number" name="tuition_pending_fee" class="form-control" readonly value="{{ student.tuition_pending_fee }}">
            </div>
            <div class="col-md-6 form-group">
                <label>Tuition Amount (Now Paying)</label>
                <input type="number" name="tuition_amount" class="form-control" value="">
            </div>
        </div>-->
 
        <!-- Transport Fee Section -->
        <!--<div class="section-heading">Transport Fee</div>
        <div class="row">
            <div class="col-md-4 form-group">
                <label>Transport Fee</label>
                <input type="number" name="transport_fee" class="form-control" readonly value="{{ student.transport_fee }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Transport Paid</label>
                <input type="number" name="transport_fee_paid" class="form-control" readonly value="{{ student.transport_fee_paid }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Transport Pending</label>
                <input type="number" name="transport_pending_fee" class="form-control" readonly value="{{ student.transport_pending_fee }}">
            </div>
            <div class="col-md-6 form-group">
                <label>Transport Amount (Now Paying)</label>
                <input type="number" name="transport_amount" class="form-control" value="">
            </div>
        </div>-->
 
        <!-- Hostel Fee Section -->
        <!--<div class="section-heading">Hostel Fee</div>
        <div class="row">
            <div class="col-md-4 form-group">
                <label>Hostel Fee</label>
                <input type="number" name="hostel_fee" class="form-control" readonly value="{{ student.hostel_fee }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Hostel Paid</label>
                <input type="number" name="hostel_fee_paid" class="form-control" readonly value="{{ student.hostel_fee_paid }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Hostel Pending</label>
                <input type="number" name="hostel_pending_fee" class="form-control" readonly value="{{ student.hostel_pending_fee }}">
            </div>
            <div class="col-md-6 form-group">
                <label>Hostel Amount (Now Paying)</label>
                <input type="number" name="hostel_amount" class="form-control" value="">
            </div>
        </div>-->
 
        <!-- Books Fee Section -->
        <!--<div class="section-heading">Books Fee</div>
        <div class="row">
            <div class="col-md-4 form-group">
                <label>Books Fee</label>
                <input type="number" name="books_fee" class="form-control" readonly value="{{ student.books_fee }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Books Paid</label>
                <input type="number" name="books_fee_paid" class="form-control" readonly value="{{ student.books_fee_paid }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Books Pending</label>
                <input type="number" name="books_pending_fee" class="form-control" readonly value="{{ student.books_pending_fee }}">
            </div>
            <div class="col-md-6 form-group">
                <label>Books Amount (Now Paying)</label>
                <input type="number" name="books_amount" class="form-control" value="">
            </div>
        </div>-->
 
        <!-- Uniform Fee Section -->
        <!--<div class="section-heading">Uniform Fee</div>
        <div class="row">
            <div class="col-md-4 form-group">
                <label>Uniform Fee</label>
                <input type="number" name="uniform_fee" class="form-control" readonly value="{{ student.uniform_fee }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Uniform Paid</label>
                <input type="number" name="uniform_fee_paid" class="form-control" readonly value="{{ student.uniform_fee_paid }}">
            </div>
            <div class="col-md-4 form-group">
                <label>Uniform Pending</label>
                <input type="number" name="uniform_pending_fee" class="form-control" readonly value="{{ student.uniform_pending_fee }}">
            </div>
            <div class="col-md-6 form-group">
                <label>Uniform Amount (Now Paying)</label>
                <input type="number" name="uniform_amount" class="form-control" value="">
            </div>
        </div>-->
 
        <!-- Other Fee Section -->
        <!--<div class="section-heading">Other Fee</div>
        <div class="row">
            <div class="col-md-6 form-group">
                <label>Other Fee Name</label>
                <input type="text" name="other_fee" class="form-control" value="{{ student.other_fee }}">
            </div>
            <div class="col-md-6 form-group">
                <label>Other Amount</label>
                <input type="number" name="other_amount" class="form-control" value="{{ student.other_amount }}">
            </div>
        </div>-->
 
        <!-- Additional Info -->
        <!--<div class="section-heading">Additional Info</div>
        <div class="row">
            <div class="col-md-6 form-group">
                <label>Next Installment</label>
                <input type="number" name="next_installment" class="form-control" value="{{ student.next_installment }}">
            </div>
            <div class="col-md-6 form-group">
                <label>Next Due Date</label>
                <input type="date" name="student.next_due_date" class="form-control" value="{{ student.next_due_date|date:'Y-m-d' }}">
            </div>
        </div>-->
 
        <!-- Payment Method -->
        <!--<div class="form-group">
            <label>Payment Method</label>
            <select name="payment_method" id="payment_method" class="form-control">
                <option value="">Select</option>
                <option value="Cash" {% if student.payment_method == 'Cash' %}selected{% endif %}>Cash</option>
                <option value="Online" {% if student.payment_method == 'Online' %}selected{% endif %}>Online</option>
            </select>
        </div>-->
 
        <!-- QR Code Section -->
        <!--<div id="qr-code-section" class="form-group" style="display: none;">
            <label>Scan to Pay (QR Code)</label><br>
            <img id="qr-code-img" src="" alt="QR Code" width="180" height="180">
        </div>-->
 
        <!-- Hidden status field -->
        <!--<input type="hidden" name="status" value="Paid">-->
 
        <!-- Submit Button -->
        <!--<button type="submit" class="btn btn-success">Save</button>
    </form>
</div>
 
 
 
<script>
 
    document.addEventListener('DOMContentLoaded', function () {
 
        const paymentMethod = document.getElementById("payment_method");
 
        const qrSection = document.getElementById("qr-code-section");
 
        const qrImg = document.getElementById("qr-code-img");
 
        // All fee amount fields to be tracked
 
        const amountFields = [
 
            "tuition_amount",
 
            "transport_amount",
 
            "hostel_amount",
 
            "books_amount",
 
            "uniform_amount",
 
            "other_amount"
 
        ].map(id => document.getElementById(id));
 
        function calculateTotalAmount() {
 
            return amountFields.reduce((total, field) => {
 
                const value = parseFloat(field.value) || 0;
 
                return total + value;
 
            }, 0).toFixed(2);
 
        }
 
        function updateQR() {
 
            const method = paymentMethod.value.trim().toLowerCase();
 
            const totalAmount = calculateTotalAmount();
 
            if (method === "online" && totalAmount > 0) {
 
                qrSection.style.display = "block";
 
                qrImg.src = `/generate_qr_dynamic?amount=${totalAmount}`;
 
            } else {
 
                qrSection.style.display = "none";
 
                qrImg.src = "";
 
            }
 
        }
 
        // Trigger on any change in payment method or amount fields
 
        paymentMethod.addEventListener('change', updateQR);
 
        amountFields.forEach(field => field.addEventListener('input', updateQR));
 
    });
</script>-->
 
 
<!-- jQuery for fetch button -->
<!--<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $('#fetchData').on('click', function () {
        var admissionNo = $('#admission_no').val().trim();
        if (admissionNo !== '') {
            $.ajax({
                url: "{% url 'get_student_details' %}",
                data: { 'admission_no': admissionNo },
                dataType: 'json',
                success: function (data) {
                    if (data.error) {
                        alert("No data found!");
                    } else {
                        $('#name').val(data.student_name);
                        $('#course').val(data.course);
                        $('#tuition_fee').val(data.tuition_fee);
                        $('#scholarship').val(data.scholarship);
                        $('#tuition_advance_amount').val(data.tuition_advance_amount);
                        $('#final_fee_after_advance').val(data.final_fee_after_advance);
                        $('#tuition_fee_paid').val(data.tuition_fee_paid);
                        $('#tuition_pending_fee').val(data.tuition_pending_fee);
                        $('#tuition_amount').val(data.tuition_amount);
 
                        $('#transport_fee').val(data.transport_fee);
                        $('#transport_fee_paid').val(data.transport_fee_paid);
                        $('#transport_pending_fee').val(data.transport_pending_fee);
                        $('#transport_amount').val(data.transport_amount);
 
                        $('#hostel_fee').val(data.hostel_fee);
                        $('#hostel_fee_paid').val(data.hostel_fee_paid);
                        $('#hostel_pending_fee').val(data.hostel_pending_fee);
                        $('#hostel_amount').val(data.hostel_amount);
 
                        $('#books_fee').val(data.books_fee);
                        $('#books_fee_paid').val(data.books_fee_paid);
                        $('#books_pending_fee').val(data.books_pending_fee);
                        $('#books_amount').val(data.books_amount);
 
                        $('#uniform_fee').val(data.uniform_fee);
                        $('#uniform_fee_paid').val(data.uniform_fee_paid);
                        $('#uniform_pending_fee').val(data.uniform_pending_fee);
                        $('#uniform_amount').val(data.uniform_amount);
 
                        $('#other_fee').val(data.other_fee);
                        $('#other_amount').val(data.other_amount);
                    }
                },
                error: function () {
                    alert("Fetch failed. Check server.");
                }
            });
        }
    });
</script>
<script>
    function calculateFees() {
        // Get input values
        var tuitionFee = parseFloat($('#tuition_fee').val()) || 0;
        var scholarship = parseFloat($('#scholarship').val()) || 0;
        var advance = parseFloat($('#tuition_advance_amount').val()) || 0;
 
        // Calculate final tuition after deductions
        var finalTuition = tuitionFee - scholarship - advance;
        $('#final_fee_after_advance').val(finalTuition.toFixed(2));
 
        // Tuition Calculation
        var origTuitionPaid = parseFloat($('#tuition_fee_paid').attr('data-orig')) || 0;
        var tuitionNowPaying = parseFloat($('#tuition_amount').val()) || 0;
        var totalTuitionPaid = origTuitionPaid + tuitionNowPaying;
        var tuitionPending = finalTuition - totalTuitionPaid;
 
        $('#tuition_fee_paid').val(totalTuitionPaid.toFixed(2));
        $('#tuition_pending_fee').val(tuitionPending.toFixed(2));
 
        // Other fees calculation
        ['transport', 'hostel', 'books', 'uniform'].forEach(function (section) {
            var fee = parseFloat($('#' + section + '_fee').val()) || 0;
            var origPaid = parseFloat($('#' + section + '_fee_paid').attr('data-orig')) || 0;
            var payingNow = parseFloat($('#' + section + '_amount').val()) || 0;
            var newPaid = origPaid + payingNow;
            var newPending = fee - newPaid;
 
            $('#' + section + '_fee_paid').val(newPaid.toFixed(2));
            $('#' + section + '_pending_fee').val(newPending.toFixed(2));
        });
    }
 
    $(document).ready(function () {
        // Initialize data-orig on load if not set
        ['tuition', 'transport', 'hostel', 'books', 'uniform'].forEach(function (section) {
            var paidField = $('#' + section + '_fee_paid');
            if (!paidField.attr('data-orig')) {
                paidField.attr('data-orig', parseFloat(paidField.val()) || 0);
            }
        });
 
        // Initial calculation
        calculateFees();
 
        // Event listeners
        $('#tuition_amount, #tuition_fee, #scholarship, #tuition_advance_amount').on('input', calculateFees);
 
        ['transport', 'hostel', 'books', 'uniform'].forEach(function (section) {
            $('#' + section + '_amount').on('input', calculateFees);
        });
 
        // AJAX to fetch student data
        $('#admission_no').on('change', function () {
            var admissionNo = $(this).val();
            if (!admissionNo) return;
 
            $.ajax({
                url: '/get_student_details/',
                method: 'GET',
                data: { admission_no: admissionNo },
                success: function (data) {
                    if (data.error) {
                        alert("No data found!");
                    } else {
                        for (const key in data) {
                            if (key === 'tuition_amount') continue; // Don't overwrite tuition_amount!
                            var el = $('#' + key);
                            el.val(data[key]);
                            if (key.endsWith('_fee_paid')) {
                                el.attr('data-orig', parseFloat(data[key]) || 0);
                            }
                        }
                        calculateFees();
                    }
                },
                error: function () {
                    alert("Failed to fetch student data.");
                }
            });
        });
    });
</script>
{% endblock %}-->
 
 