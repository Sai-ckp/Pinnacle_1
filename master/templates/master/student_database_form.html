{% extends 'layout.html' %}
{% block title %}{% if edit_mode %}Edit Student Form{% else %}Student Details{% endif %}{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<style>
    .student-data-container {
        max-width: 976px;
        margin: 50px auto;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    h2 {
        font-size: 20px;
        font-weight: 700;
        color: #800000;
        text-align: center;
        margin-bottom: 21px;
    }

    .form-group label {
        font-size: 12px;
        font-weight: 600;
    }

    .form-control {
        font-size: 9px;
        border-radius: 6px;
        padding: 4px 8px;
    }

    .btn-submit {
        background-color: #800000;
        color: white;
        font-size: 12px;
        padding: 6px 16px;
        border-radius: 6px;
        border: none;
        font-weight: 600;
    }

        .btn-submit:hover {
            background-color: #800000;
            color: white;
        }

    .form-group {
        margin-bottom: 1px;
    }

    .tab-card {
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        background: #ffffff;
        padding: 9px;
        margin-top: -36px;
    }


    .content {
        margin-left: 200px;
        padding: 13px 26px 40px;
        min-height: 100vh;
    }
</style>

<div class="student-data-container">
    <div class="tab-card">
        <h2>{% if edit_mode %}Edit Student Form{% else %}Student Details{% endif %}</h2>

        {% if edit_mode %}
        <form method="post">
            {% csrf_token %}
            {% endif %}

            {% if form and form.errors %}
            <div class="alert alert-danger">
                <ul>
                    {% for field in form %}
                    {% for error in field.errors %}
                    <li>{{ field.label }}: {{ error }}</li>
                    {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <div class="form-group">
                <label>Admission Number:</label>

                {% if student.pu_admission %}
                <input type="text" class="form-control" value="{{ student.pu_admission.admission_no }}" readonly style="background:#eee;">
                {% if edit_mode %}
                <input type="hidden" name="pu_admission" value="{{ student.pu_admission.id }}">
                {% endif %}

                {% elif student.degree_admission %}
                <input type="text" class="form-control" value="{{ student.degree_admission.admission_no }}" readonly style="background:#eee;">
                {% if edit_mode %}
                <input type="hidden" name="degree_admission" value="{{ student.degree_admission.id }}">
                {% endif %}

                {% else %}
                <input type="text" class="form-control" value="N/A" readonly style="background:#eee;">
                {% endif %}
            </div>


            <div class="form-group">
                <label>Student Name:</label>
                {% if edit_mode %}
                {{ form.student_name }}
                {% else %}
                <input type="text" class="form-control" value="{{ student.student_name }}" readonly style="background:#eee;">
                <input type="hidden" name="student_name" value="{{ student.student_name }}">
                {% endif %}
            </div>

            <div class="form-group">
                <label>Combination:</label>
                {{ form.course }}
            </div>




            <div class="form-group">
                <label>Program Type:</label>
                {{ form.course_type }}
            </div>


            <div class="form-group">
                <label>Status:</label>
                {% if edit_mode %}
                {{ form.status }}
                {% else %}
                <input type="text" class="form-control" value="{{ student.status }}" readonly style="background:#eee;">
                {% endif %}
            </div>


            <div class="form-group">
                <label>Student User ID:</label>
                {{ form.student_userid }}
            </div>


            <div class="form-group">
                <label>Quota Type:</label>
                {% if edit_mode %}
                {{ form.quota_type }}
                {% else %}
                <input type="text" class="form-control" value="{{ student.quota_type }}" readonly style="background:#eee;">
                {% endif %}
            </div>

            <div class="form-group">
                <label>Father Name:</label>
                {% if edit_mode %}
                {{ form.father_name }}
                {% else %}
                <input type="text" class="form-control" value="{{ student.father_name }}" readonly style="background:#eee;">
                {% endif %}
            </div>

            <div class="form-group">
                <label>Student Phone No:</label>
                {% if edit_mode %}
                {{ form.student_phone_no }}
                <div id="phone-error" class="text-danger" style="font-size: 10px; display: none;"></div>
                {% else %}
                <input type="text" class="form-control" value="{{ student.student_phone_no }}" readonly style="background:#eee;">
                {% endif %}
            </div>

            <div class="form-group d-flex justify-content-between mt-4">
                <div>
                    <a href="{% url back_to_list_url %}?course_type={{ selected_type }}" class="btn-submit">Back</a>
                </div>
                {% if edit_mode %}
                <button type="submit" class="btn-submit" id="submitBtn">
                    {% if form.instance.pk %}Update{% else %}Save{% endif %}
                </button>
                {% endif %}
            </div>

            {% if edit_mode %}
        </form>
        {% endif %}
    </div>
</div>

{% if edit_mode %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const phoneInput = document.getElementById("id_student_phone_no");
        const errorDiv = document.getElementById("phone-error");
        const form = phoneInput.closest("form");

        if (phoneInput) {
            // Only allow numeric input and max 10 digits
            phoneInput.addEventListener("input", function () {
                this.value = this.value.replace(/\D/g, "").slice(0, 10);
                validatePhone();
            });

            phoneInput.addEventListener("keypress", function (e) {
                if (!/[0-9]/.test(e.key)) {
                    e.preventDefault();
                }
            });

            function validatePhone() {
                const value = phoneInput.value.trim();
                let error = "";

                if (value && value.length !== 10) {
                    error = "Phone number must be exactly 10 digits.";
                } else if (value && !/^[6-9]/.test(value)) {
                    error = "Phone number must start with 6, 7, 8, or 9.";
                }

                if (error) {
                    errorDiv.textContent = error;
                    errorDiv.style.display = "block";
                    return false;
                } else {
                    errorDiv.textContent = "";
                    errorDiv.style.display = "none";
                    return true;
                }
            }

            form.addEventListener("submit", function (e) {
                if (!validatePhone()) {
                    e.preventDefault();
                    phoneInput.focus();
                }
            });
        }
    });
</script>
{% endif %}
{% endblock %}
